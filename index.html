<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Primary Meta Tags -->
    <title>Hệ thống Thi Trắc nghiệm Trực tuyến - PTDTNT ATK Sơn Dương</title>
    <meta name="title" content="Hệ thống Thi Trắc nghiệm Trực tuyến - PTDTNT ATK Sơn Dương" />
    <meta name="description" content="Hệ thống thi trắc nghiệm trực tuyến với tính năng chống gian lận và tích hợp AI. Hỗ trợ giáo viên tạo bài thi, học sinh làm bài và quản lý kết quả hiệu quả." />
    <meta name="keywords" content="thi trắc nghiệm, thi online, hệ thống thi, PTDTNT ATK Sơn Dương, giáo dục, kiểm tra trực tuyến, chống gian lận, AI giáo dục" />
    <meta name="author" content="PTDTNT ATK Sơn Dương" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="Vietnamese" />
    <meta name="revisit-after" content="7 days" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/logo.png" />
    <link rel="apple-touch-icon" href="/images/logo.png" />
    <link rel="shortcut icon" href="/images/logo.png" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://khaothi.vercel.app/" />
    <meta property="og:title" content="Hệ thống Thi Trắc nghiệm Trực tuyến - PTDTNT ATK Sơn Dương" />
    <meta property="og:description" content="Hệ thống thi trắc nghiệm trực tuyến với tính năng chống gian lận và tích hợp AI. Hỗ trợ giáo viên tạo bài thi, học sinh làm bài và quản lý kết quả hiệu quả." />
    <meta property="og:image" content="/images/logo.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="vi_VN" />
    <meta property="og:site_name" content="Hệ thống Thi Trắc nghiệm PTDTNT ATK Sơn Dương" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://khaothi.vercel.app/" />
    <meta property="twitter:title" content="Hệ thống Thi Trắc nghiệm Trực tuyến - PTDTNT ATK Sơn Dương" />
    <meta property="twitter:description" content="Hệ thống thi trắc nghiệm trực tuyến với tính năng chống gian lận và tích hợp AI. Hỗ trợ giáo viên tạo bài thi, học sinh làm bài và quản lý kết quả hiệu quả." />
    <meta property="twitter:image" content="/images/logo.png" />
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#2563eb" />
    <meta name="msapplication-TileColor" content="#2563eb" />
    
    <!-- Additional SEO -->
    <meta name="application-name" content="Hệ thống Thi Trắc nghiệm" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Thi Trắc nghiệm" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
  </head>
  <body>
    <div id="root"></div>
    <!-- Fix redirect về localhost issue - chạy ngay khi HTML load -->
    <script>
      (function() {
        'use strict';
        
        // Production URL - có thể thay đổi nếu cần
        const PRODUCTION_URL = 'https://www.hethongthi.online';
        
        // Function để fix redirect về localhost
        function fixLocalhostRedirect() {
          const currentOrigin = window.location.origin;
          const currentHref = window.location.href;
          
          // Nếu detect redirect về localhost, fix ngay lập tức
          if (currentOrigin.includes('localhost:3000') || 
              (currentOrigin.includes('localhost') && currentOrigin !== 'http://localhost:5173')) {
            console.error('[Preload] WARNING: Redirected to localhost! Fixing...');
            console.error('[Preload] Current origin:', currentOrigin);
            console.error('[Preload] Current href:', currentHref);
            
            // Giữ lại pathname, search, và hash
            const pathname = window.location.pathname;
            const search = window.location.search;
            const hash = window.location.hash;
            
            // Tạo URL mới với production domain
            const newUrl = PRODUCTION_URL + pathname + search + hash;
            
            console.log('[Preload] Redirecting to:', newUrl);
            
            // Redirect ngay lập tức
            window.location.replace(newUrl);
            return true; // Đã redirect
          }
          return false; // Không cần redirect
        }
        
        // Kiểm tra ngay khi script load
        if (fixLocalhostRedirect()) {
          return; // Đã redirect, không cần làm gì nữa
        }
        
        // Listen cho hashchange (OAuth callback thường dùng hash)
        window.addEventListener('hashchange', function() {
          console.log('[Preload] Hash changed, checking for localhost redirect...');
          fixLocalhostRedirect();
        }, true); // Use capture phase để chạy sớm nhất
        
        // Listen cho popstate
        window.addEventListener('popstate', function() {
          console.log('[Preload] Popstate, checking for localhost redirect...');
          fixLocalhostRedirect();
        }, true);
        
        // Intercept history API
        const originalPushState = history.pushState;
        const originalReplaceState = history.replaceState;
        
        history.pushState = function() {
          originalPushState.apply(history, arguments);
          setTimeout(fixLocalhostRedirect, 0);
        };
        
        history.replaceState = function() {
          originalReplaceState.apply(history, arguments);
          setTimeout(fixLocalhostRedirect, 0);
        };
        
        console.log('[Preload] Localhost redirect interceptor initialized');
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

